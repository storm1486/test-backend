import { Strategy } from "./ancillary.js";
import { isGetterDescriptor, memoizeGetter } from "./getter.js";
import { isMethodDescriptor, memoizeMethod } from "./method.js";
export * from "./ancillary.js";
function defaultDigest(...args) {
    let result = "";
    for (let i = 0, length = args.length; i < length; i++) {
        result += `${args[i]}$!$`;
    }
    return result;
}
export function memoize(params) {
    const hashFunction = params?.hashFunction || defaultDigest;
    const strategy = params?.strategy || Strategy.WEAKMAP;
    const argsCacheBuilder = params?.argsCacheBuilder || (() => new Map());
    return (target, propertyKey, descriptor) => {
        if (isMethodDescriptor(descriptor)) {
            memoizeMethod(descriptor, propertyKey, strategy, hashFunction, argsCacheBuilder);
            return;
        }
        if (isGetterDescriptor(descriptor)) {
            memoizeGetter(descriptor, propertyKey, strategy);
            return;
        }
        throw new Error("Decorate only a method or get accessor");
    };
}
export const Memoize = memoize;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFrQyxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsYUFBYSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFaEUsY0FBYyxnQkFBZ0IsQ0FBQztBQVEvQixTQUFTLGFBQWEsQ0FBQyxHQUFHLElBQVc7SUFDbkMsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDckQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7S0FDM0I7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBdUJELE1BQU0sVUFBVSxPQUFPLENBQUMsTUFBd0I7SUFDOUMsTUFBTSxZQUFZLEdBQWlCLE1BQU0sRUFBRSxZQUFZLElBQUksYUFBYSxDQUFDO0lBQ3pFLE1BQU0sUUFBUSxHQUFhLE1BQU0sRUFBRSxRQUFRLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQztJQUNoRSxNQUFNLGdCQUFnQixHQUNwQixNQUFNLEVBQUUsZ0JBQWdCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDaEQsT0FBTyxDQUNMLE1BQWMsRUFDZCxXQUE0QixFQUM1QixVQUF3QyxFQUN4QyxFQUFFO1FBQ0YsSUFBSSxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsRUFBRTtZQUNsQyxhQUFhLENBQ1gsVUFBVSxFQUNWLFdBQVcsRUFDWCxRQUFRLEVBQ1IsWUFBWSxFQUNaLGdCQUFnQixDQUNqQixDQUFDO1lBQ0YsT0FBTztTQUNSO1FBQ0QsSUFBSSxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsRUFBRTtZQUNsQyxhQUFhLENBQUMsVUFBVSxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNqRCxPQUFPO1NBQ1I7UUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7SUFDNUQsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUtELE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMifQ==